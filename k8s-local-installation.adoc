= Local Kubernetes Installation using Minikube

== Setup Minikube

Minikube v0.23.0 or higher is required for docker server https://github.com/moby/moby/pull/31352[17.05],
which adds support for using `ARG` in `FROM` in your `Dockerfile`.
This is how Confluent Docker images are built with our standard build/CI pipeline.

Following https://github.com/kubernetes/minikube/releases[install instructions].

[source,shell]
----
curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.23.0/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/
----

Following https://github.com/kubernetes/minikube/blob/master/DRIVERS.md#xhyve-driver[driver instructions]

[source,shell]
----
brew install docker-machine-driver-xhyve
sudo chown root:wheel /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
sudo chmod u+s /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
----

== Start minikube

[source,shell]
----
$ minikube start --kubernetes-version v1.8.0 --cpus 4 --memory 6096 --vm-driver=xhyve --v=8

# Run this until both minikubeVM and localkube are Running
$ minikube status
minikubeVM: Running
localkube: Running

minikube ssh
  sudo ip link set docker0 promisc on
  exit
eval $(minikube docker-env)
kubectl config set-context minikube.internal --cluster=minikube --user=minikube
kubectl config use-context minikube.internal
----